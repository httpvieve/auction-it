{% extends "auctions/layout.html" %}

{% block body %}

{% if message %}

{% endif %}

    <h2> Listing: {{ listing.item_name }} </h2>

    <img src="{{ listing.item_image }}" width=500" height="500">
    <p> {{ listing.item_description }} </p>

    {% if listing.is_available %}
    <h3>${{ listing.starting_bid }}</h3>
    <p> {{listing.watchers.count }} user(s) are currently watching this item. </p>
    <p> {{ count }} bid(s) so far. </p> 

    
    {% if user != listing.auctioneer %} 

        {% if user not in listing.watchers.all %}
            <a href={%url 'add_to_watchlist' listing.id %} >Add to Watchlist</a>
        {% else %}
            <p> Listing is currently in your watchlist. </p>
            <a href="{% url 'remove_from_watchlist' listing.id %}">Remove from Watchlist</a>
        {% endif %}

        <a href={%url 'create_bid' listing.id %} >Bid</a>

        {% else %}

        {% if count != 0%}
        <h4> Bid Transactions :</h4>
                {% for bid in bids %}
                        {% if bid.current_item.item_name == listing.item_name %}
                            <ul><li> 
                            <p>{{bid.current_user}} bids for {{bid.bid_offer}}</p>
                            </li></ul>
                        {% endif %}
                {% endfor %}
                <a href="{% url 'close_auction' listing.id %}">Accept bid offer</a>
            {% else %}
                <h4>No bids yet.</h4>
            {% endif %}
        {% endif %}
    {% else %} 
        <h5>This auction is closed and no longer accepting bids. This item was sold for ${{listing.current_bid}}.</h5>
    {% endif %}


    <h3>Details</h3>
    <ul>
    <li>Listed by: {{listing.auctioneer}} </li>
    <li>Category: {{listing.item_category.name}} </li>
    </ul>
    <h4> All comments: </h4>
    {% for comment in comments %}
        <p> <strong>{{user.username}} </strong> {{comment.time_created}}</p>
        <p> {{comment.comment}} </p>

    {% empty %}
        <p>This listing has no comments yet.</p>
    {% endfor %}
    <h4>Add a Comment</h4>
    <form method="post">
        {% csrf_token %}
        {{ comment_form.as_p }}
        <button type="submit" class="btn btn-primary">Submit Comment</button>
    </form>

    

{% endblock %}